kind: pipeline
type: docker
name: Docker Build

trigger:
  event:
  - cron
  cron:
  - weekly

steps:
- name: DockerHub  
  image: plugins/docker
  settings:
    username: fuzzymistborn
    password:
      from_secret: dockerhub_pw
    repo: fuzzymistborn/docker-linting
    tags: latest

- name: GH Container Registry  
  image: plugins/docker
  settings:
    username: fuzzymistborn
    password:
      from_secret: ghcr_pw
    repo: ghcr.io/fuzzymistborn/docker-linting
    registry: ghcr.io
    tags: latest

- name: Send TG Notification
  image: appleboy/drone-telegram
  settings:
    token:
      from_secret: tg_token
    to:
      from_secret: tg_id
    format: markdown
    message: "{{#success build.status}}âœ…  Build for `{{repo.name}}` was *successful*!{{else}}âŒ  Build for `{{repo.name}}` has *FAILED*!{{/success}} \nğŸŒ  [Output]({{build.link}})\nğŸ“  Commit: {{ commit.message }}"
  when:
    status: [ success, failure ]
